\section{Implemtation}

\subsection{Software integration}
\label{sec:SoftwareInt}
Running on the ESP32 microcontroller, the firmware manages the voice activity detection, system control, and communication tasks, with external platforms for data visualization and interaction. A flowchart representing the code running on the MCU can be seen in Figure \ref{fig:firmwareFlowchart}. 

\begin{figure}[H]
    \centering
    \includegraphics*[scale = 0.5]{Images/FirmawareFlowChart.png}
    \caption{Firmware Flowchart.}
    \label{fig:firmwareFlowchart}
\end{figure}

After validating and successfully testing the user interaction and voice detection code independently, the two were merged into a single firmware following the flowchart shown in Figure \ref{fig:firmwareFlowchart}. This presented unforeseen problems, since the voice detecting code is already pushing the limits of what the Esp32 can do, when merged with code that also uses WiFi, which is a process intensive task, the Esp32 was not able to handle everything together.

To address this, audio processing tasks were pinned to Core 1 while WiFi operations were confined to Core 0, leveraging the dual-core architecture of the ESP32. Additionally, the I2S peripheral, critical for audio data handling, was configured with a higher interrupt priority to ensure timely processing. Despite these optimizations, the system's performance remained inadequate, indicating that the ESP32's computational resources are insufficient for handling both tasks simultaneously at the required level of performance.

\textcolor{red}{METER NA SECCAO CERTA}
Future work should explore the use of a more powerful MCU capable of handling the increased computational and memory demands. Possible candidates could be the ESP32-S3,STM32F746 or Teensy 4.1 .

\subsection{Analog Filter}

\subsubsection{Test}

\begin{figure}[H]
    \centering
    \includegraphics*[scale = 0.5]{Images/AnalogFilterScoppyBode.png}
    \caption{Analog Filter Bode.}
    \label{fig:AnalogFilterBodeScoppy}
\end{figure}
